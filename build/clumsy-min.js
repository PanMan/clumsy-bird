var game={data:{score:0,steps:0,start:!1,newHiScore:!1},onload:function(){me.video.init("screen",900,600,!0,"auto")?(me.audio.init("mp3,ogg"),me.loader.onload=this.loaded.bind(this),me.loader.preload(game.resources),me.state.change(me.state.LOADING)):alert("Your browser does not support HTML5 canvas.")},loaded:function(){me.state.set(me.state.MENU,new game.TitleScreen);me.state.set(me.state.PLAY,new game.PlayScreen);me.state.set(me.state.GAME_OVER,new game.GameOverScreen);me.input.bindKey(me.input.KEY.SPACE,
"fly",!0);me.input.bindTouch(me.input.KEY.SPACE);me.pool.register("clumsy",BirdEntity);me.pool.register("hit",HitEntity,!0);me.game.viewport.setBounds(0,0,900,600);me.state.change(me.state.MENU)},resources:[{name:"bg",type:"image",src:"data/img/bg.png"},{name:"clumsy",type:"image",src:"data/img/clumsy.png"},{name:"logo",type:"image",src:"data/img/logo.png"},{name:"ground",type:"image",src:"data/img/ground.png"},{name:"gameover",type:"image",src:"data/img/gameover.png"},{name:"gameoverbg",type:"image",
src:"data/img/gameoverbg.png"},{name:"hit",type:"image",src:"data/img/hamburger.png"},{name:"getready",type:"image",src:"data/img/getready.png"},{name:"new",type:"image",src:"data/img/new.png"},{name:"share",type:"image",src:"data/img/share.png"},{name:"tweet",type:"image",src:"data/img/tweet.png"},{name:"theme",type:"audio",src:"data/bgm/"},{name:"lose",type:"audio",src:"data/sfx/"}]};me.device.isMobile||game.resources.push({name:"eat",type:"audio",src:"data/sfx/"});
var BirdEntity=me.ObjectEntity.extend({init:function(a,c){var b={};b.image=me.loader.getImage("clumsy");b.width=167;b.height=117;b.spritewidth=167;b.spriteheight=117;this.parent(a,c,b);this.alwaysUpdate=!0;this.gravity=.1;this.gravityForce=.01;this.maxAngleRotation=Number.prototype.degToRad(30);this.maxAngleRotationDown=Number.prototype.degToRad(90);this.renderable.addAnimation("flying",[0,1,2]);this.renderable.addAnimation("idle",[0]);this.renderable.setCurrentAnimation("flying");this.animationController=
0;this.addShape(new me.Rect(new me.Vector2d(0,0),125,100));this.flyTween=new me.Tween(this.pos);this.flyTween.easing(me.Tween.Easing.Exponential.InOut)},update:function(a){if(game.data.start)if(me.input.isKeyPressed("fly")){this.gravityForce=.01;var c=this.pos.y;this.flyTween.stop();this.flyTween.to({y:c-72},100);this.flyTween.start()}else this.gravityForce+=.2,this.pos.y+=me.timer.tick*this.gravityForce;if(c=me.game.collide(this)){if("hit"!=c.obj.type)return me.device.vibrate(500),me.state.change(me.state.GAME_OVER),
!1;me.game.world.removeChildNow(c.obj);game.data.steps++;me.audio.play("eat")}else if(this.pos.y>=me.game.viewport.height-110||-120>=this.pos.y)return me.state.change(me.state.GAME_OVER),!1;return this.parent(a)}}),hitfreq=92,PipeGenerator=me.Renderable.extend({init:function(){this.parent(new me.Vector2d,me.game.viewport.width,me.game.viewport.height);this.alwaysUpdate=!0;this.generate=0;this.pipeHoleSize=1240;this.posX=me.game.viewport.width},update:function(a){0==this.generate++%hitfreq&&(a=Number.prototype.random(me.video.getHeight()-
100,200)-100,a=new me.pool.pull("hit",this.posX,a),me.game.world.addChild(a,11));return!0}}),HitEntity=me.ObjectEntity.extend({init:function(a,c){var b={};b.image=me.loader.getImage("hit");b.width=128;b.height=128;b.spritewidth=128;b.spriteheight=128;this.parent(a,c,b);this.alwaysUpdate=!0;this.gravity=5;this.updateTime=!1;this.type="hit";this.ac=new me.Vector2d(-this.gravity,0)},update:function(){this.pos.add(this.ac);-148>this.pos.x&&me.game.world.removeChild(this);return!0}}),Ground=me.ObjectEntity.extend({init:function(a,
c){var b={};b.image=me.loader.getImage("ground");b.width=900;b.height=96;this.parent(a,c,b);this.alwaysUpdate=!0;this.gravity=0;this.updateTime=!1;this.accel=new me.Vector2d(-4,0)},update:function(){this.pos.add(this.accel);this.pos.x<-this.renderable.width&&(this.pos.x=me.video.getWidth()-10);return!0}}),TheGround=Object.extend({init:function(){this.ground1=new Ground(0,me.video.getHeight()-96);this.ground2=new Ground(me.video.getWidth(),me.video.getHeight()-96);me.game.world.addChild(this.ground1,
11);me.game.world.addChild(this.ground2,11)},update:function(){return!0}});game.HUD=game.HUD||{};game.HUD.Container=me.ObjectContainer.extend({init:function(){this.parent();this.isPersistent=!0;this.collidable=!1;this.z=Infinity;this.name="HUD";this.addChild(new game.HUD.ScoreItem(5,5))}});
game.HUD.ScoreItem=me.Renderable.extend({init:function(a,c){this.parent(new me.Vector2d(a,c),10,10);this.stepsFont=new me.Font("gamefont",80,"#000","center");this.floating=!0},update:function(){return!0},draw:function(a){game.data.start&&me.state.isCurrent(me.state.PLAY)&&this.stepsFont.draw(a,game.data.steps,me.video.getWidth()/2,10)}});
var BackgroundLayer=me.ImageLayer.extend({init:function(a,c,b){name=a;width=900;height=600;ratio=1;this.pos.x=0;this.fixed=0<b?!1:!0;this.accel=new me.Vector2d(2,0);this.parent(name,width,height,a,c,ratio)},update:function(){this.fixed||(this.pos.add(this.accel),this.pos.x<-this.width&&(this.pos.x=me.video.getWidth()-10));return!0}}),Share=me.GUI_Object.extend({init:function(){var a={},c=me.video.getWidth()/2-170,b=me.video.getHeight()/2+200;a.image="share";a.spritewidth=150;a.spriteheight=75;this.parent(c,
b,a)},onClick:function(a){FB.ui({method:"feed",name:"Burgerfest",caption:"Share to your friends",description:"Just ate "+game.data.steps+" burgers on Burgerfest! Got the munchies? Play the burger game",link:"http://burgerfest.nl/",picture:"http://burgerfest.nl/data/img/hamburger.png"});return!1}}),Tweet=me.GUI_Object.extend({init:function(){var a={},c=me.video.getWidth()/2+10,b=me.video.getHeight()/2+200;a.image="tweet";a.spritewidth=152;a.spriteheight=75;this.parent(c,b,a)},onClick:function(a){window.open("https://twitter.com/intent/tweet?text="+
("Just ate "+game.data.steps+" burgers on Burgerfest! Got the munchies? Play the burger game")+"&related=czardigital&hashtags=burgerfest&count=http://burgerfest.nl/&url=http://burgerfest.nl/","Tweet!","height=300,width=400");return!1}});
game.TitleScreen=me.ScreenObject.extend({init:function(){this.font=null},onResetEvent:function(){document.getElementById("loadingscreen").style.display="none";me.audio.stop("theme");game.data.newHiScore=!1;me.game.world.addChild(new BackgroundLayer("bg",1,2));me.input.bindKey(me.input.KEY.ENTER,"enter",!0);me.input.bindKey(me.input.KEY.SPACE,"enter",!0);me.input.bindMouse(me.input.mouse.LEFT,me.input.KEY.ENTER);this.handler=me.event.subscribe(me.event.KEYDOWN,function(a,b,d){"enter"===a&&me.state.change(me.state.PLAY)});
var a=me.loader.getImage("logo"),a=new me.SpriteObject(me.game.viewport.width/2-170,-a,a);me.game.world.addChild(a,10);(new me.Tween(a.pos)).to({y:me.game.viewport.height/2-100},1E3).easing(me.Tween.Easing.Exponential.InOut).start();this.ground=new TheGround;me.game.world.addChild(this.ground,11);me.game.world.addChild(new (me.Renderable.extend({init:function(){this.parent(new me.Vector2d,100,100);this.text=me.device.touch?"Tap to start":"PRESS SPACE OR CLICK LEFT MOUSE BUTTON TO START";this.font=
new me.Font("gamefont",20,"#000")},update:function(){return!0},draw:function(a){var b=this.font.measureText(a,this.text);this.font.draw(a,this.text,me.game.viewport.width/2-b.width/2,me.game.viewport.height/2+50)}})),12)},onDestroyEvent:function(){me.event.unsubscribe(this.handler);me.input.unbindKey(me.input.KEY.ENTER);me.input.unbindKey(me.input.KEY.SPACE);me.input.unbindMouse(me.input.mouse.LEFT);me.game.world.removeChild(this.ground)}});
game.PlayScreen=me.ScreenObject.extend({init:function(){me.audio.play("theme",!0);var a=me.device.ua.contains("Firefox")?.5:.75;me.audio.setVolume(a);this.parent(this)},onResetEvent:function(){me.audio.stop("theme");me.audio.play("theme",!0);me.input.bindKey(me.input.KEY.SPACE,"fly",!0);game.data.score=0;game.data.steps=0;game.data.start=!1;game.data.newHiscore=!1;me.game.world.addChild(new BackgroundLayer("bg",1,2));this.ground=new TheGround;me.game.world.addChild(this.ground,11);this.HUD=new game.HUD.Container;
me.game.world.addChild(this.HUD);this.bird=me.pool.pull("clumsy",60,me.game.viewport.height/2-100);me.game.world.addChild(this.bird,10);me.input.bindMouse(me.input.mouse.LEFT,me.input.KEY.SPACE);this.getReady=new me.SpriteObject(me.video.getWidth()/2-200,me.video.getHeight()/2-100,me.loader.getImage("getready"));me.game.world.addChild(this.getReady,11);(new me.Tween(this.getReady)).to({alpha:0},2E3).easing(me.Tween.Easing.Linear.None).onComplete(function(){game.data.start=!0;me.game.world.addChild(new PipeGenerator,
0)}).start()},onDestroyEvent:function(){me.audio.stopTrack("theme");this.bird=this.HUD=null;me.input.unbindKey(me.input.KEY.SPACE)}});
game.GameOverScreen=me.ScreenObject.extend({init:function(){this.handler=this.savedData=null},onResetEvent:function(){me.audio.play("lose");this.savedData={score:game.data.score,steps:game.data.steps};me.save.add(this.savedData);me.save.topSteps||me.save.add({topSteps:game.data.steps});game.data.steps>me.save.topSteps&&(me.save.topSteps=game.data.steps,game.data.newHiScore=!0);me.input.bindKey(me.input.KEY.ENTER,"enter",!0);me.timer.setTimeout(function(){me.input.bindKey(me.input.KEY.SPACE,"enter",
!1);me.input.bindMouse(me.input.mouse.LEFT,me.input.KEY.ENTER)},1E3,!1);this.handler=me.event.subscribe(me.event.KEYDOWN,function(a,b,d){"enter"===a&&me.state.change(me.state.MENU)});var a=me.loader.getImage("gameover");me.game.world.addChild(new me.SpriteObject(me.video.getWidth()/2-a.width/2,me.video.getHeight()/2-a.height/2-100,a),12);a=me.loader.getImage("gameoverbg");me.game.world.addChild(new me.SpriteObject(me.video.getWidth()/2-a.width/2,me.video.getHeight()/2-a.height/2,a),10);me.game.world.addChild(new BackgroundLayer("bg",
1,2));this.ground=new TheGround;me.game.world.addChild(this.ground,11);this.share=new Share;me.game.world.addChild(this.share,12);this.tweet=new Tweet;me.game.world.addChild(this.tweet,12);this.dialog=new (me.Renderable.extend({init:function(){this.parent(new me.Vector2d,100,100);this.font=new me.Font("gamefont",40,"#edd23d","left");this.steps="Burgers: "+game.data.steps.toString();this.topSteps="Max Burgers: "+me.save.topSteps.toString()},update:function(){return!0},draw:function(a){var b=this.font.measureText(a,
this.steps);this.font.measureText(a,this.topSteps);this.font.measureText(a,this.score);this.font.draw(a,this.steps,me.game.viewport.width/2-b.width/2-60,me.game.viewport.height/2);this.font.draw(a,this.topSteps,me.game.viewport.width/2-b.width/2-60,me.game.viewport.height/2+50)}}));me.game.world.addChild(this.dialog,12)},onDestroyEvent:function(){me.event.unsubscribe(this.handler);me.input.unbindKey(me.input.KEY.ENTER);me.input.unbindKey(me.input.KEY.SPACE);me.input.unbindMouse(me.input.mouse.LEFT);
me.game.world.removeChild(this.ground);this.font=null;me.audio.stop("theme")}});